{% extends "base.html" %}
{% block content %}

    <!--display errors if any-->
    {% if form.errors %}
        <p>sorry sbout that...</p>
    {% endif %}

    <!--login form, username and password-->
    <form action="/accounts/auth/" method="post">
        {% csrf_token %}
        <label for="username">User name:</label>
        <input type="text" name="username" value="" id="username">
        <label for="password">Password:</label>
        <input type="password" name="password" value="" id="password">
        <input type="submit" value="login"/>
    </form>
    <br>
    <br>
    <a href="{% url "social:begin" "google-oauth2" %}">Google+</a>
    <br>
    <a href="/login/vk-oauth2"><img src="/static/lvk.png" class="avatar-3" data-toggle="tooltip"
                                    title="{% trans 'Login via VKontakte' %}"></a>

    <br>
    <div id="google-plus-button">Google+ Sign In</div>

    <script src="https://apis.google.com/js/api:client.js"></script>

    <script type="text/javascript">
        gapi.load('auth2', function () {
            var auth2;

            auth2 = gapi.auth2.init({
                client_id: "<PUT SOCIAL_AUTH_GOOGLE_PLUS_KEY HERE>",
                scope: "<PUT BACKEND SCOPE HERE>"
            });

            auth2.then(function () {
                var button = document.getElementById("google-plus-button");
                console.log("User is signed-in in Google+ platform?", auth2.isSignedIn.get() ? "Yes" : "No");

                auth2.attachClickHandler(button, {}, function (googleUser) {
                    // Send access-token to backend to finish the authenticate
                    // with your application

                    var authResponse = googleUser.getAuthResponse();
                    var $form;
                    var $input;

                    $form = $("<form>");
                    $form.attr("action", "/complete/google-plus");
                    $form.attr("method", "post");
                    $input = $("<input>");
                    $input.attr("name", "id_token");
                    $input.attr("value", authResponse.id_token);
                    $form.append($input);
                    // Add csrf-token if needed
                    $(document.body).append($form);
                    $form.submit();
                });
            });
        });
    </script>
{% endblock %}

